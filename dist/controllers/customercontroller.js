"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var _get=function get(object,property,receiver){null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===void 0){var parent=Object.getPrototypeOf(object);if(null===parent)return void 0;return get(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return call&&("object"==typeof call||"function"==typeof call)?call:self}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var CustomerController=function(_OrderController){function CustomerController(){return _classCallCheck(this,CustomerController),_possibleConstructorReturn(this,(CustomerController.__proto__||Object.getPrototypeOf(CustomerController)).apply(this,arguments))}return _inherits(CustomerController,_OrderController),_createClass(CustomerController,[{key:"view",value:function view(){this._loadTemplate("src/views/template/customer/customer.html","#customers",GAME.model.customers)}},{key:"registerEvent",value:function registerEvent(a){var b=function b(c){var d=GAME.model.customers.filter(function(g){return g.id==a}).shift(),f=new CustomerController;c(d,f),f._updateCustomerView()};$("button[data-customer="+a+"].customer-serve").click(function(c){b(function(d,f){f.validateOrder(d.order)?f.completeOrder(d):toastr.warning(Controller.l("You don't have all the products to complete this order."))}),$(this).off(c)}),$("button[data-customer="+a+"].customer-send-away").click(function(c){b(function(d,f){f.sendAway(d)}),$(this).off(c)})}},{key:"generateOrder",value:function generateOrder(){var _this2=this,a=GAME.model.products.map(function(c){return{name:c.name,value:_get(CustomerController.prototype.__proto__||Object.getPrototypeOf(CustomerController.prototype),"randomDemandGenerator",_this2).call(_this2,c.demand.mean,c.demand.variance)}}),b=OrderController._makeOrder(a);if(b.length){var c=new Customer(b);GAME.model.customers.push(c),this._updateOrderView(c),toastr.info(Controller.l("New customer is waiting!"))}}},{key:"completeOrder",value:function completeOrder(a){this._updateMoney(a.order.orderCost());var b=new WarehouseController,c=new CustomerOrder(OrderController._copyOrder(a.order));b.orderUpdateWarehouse(c)&&_get(CustomerController.prototype.__proto__||Object.getPrototypeOf(CustomerController.prototype),"completeOrder",this).call(this,a),b.updateContainerView(),b.updateCapacityView(),GAME.model.customers=GAME.model.customers.filter(function(d){return a.id!=d.id})}},{key:"sendAway",value:function sendAway(a){GAME.model.customers=GAME.model.customers.filter(function(b){return a.id!=b.id}),GAME.model.config.penaltySendingCustomerAway&&(this._updateMoney(-GAME.model.config.penaltySendingCustomerAway),toastr.warning(Controller.l("You got a penalty for sending the customer away.")))}},{key:"validateOrder",value:function validateOrder(a){return a.products.every(function(b){var c=GAME.model.warehouse.getItemQuantity(b);return c>=b.values.quantity})}},{key:"_updateCustomerView",value:function _updateCustomerView(){$("#customer-orders").empty(),GAME.model.customers.forEach(function(a){this._updateOrderView(a)},this)}},{key:"_updateOrderView",value:function _updateOrderView(a){var _this3=this;GAME.model.customers.length&&$(".no-customers").remove(),this._loadTemplate("src/views/template/customer/customerorder.html","#customer-orders",a,!0).done(function(){return _this3.registerEvent(a.id)})}}]),CustomerController}(OrderController);