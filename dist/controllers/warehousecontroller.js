"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var _get=function get(object,property,receiver){null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===void 0){var parent=Object.getPrototypeOf(object);if(null===parent)return void 0;return get(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return call&&("object"==typeof call||"function"==typeof call)?call:self}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var WarehouseController=function(_Controller){function WarehouseController(){return _classCallCheck(this,WarehouseController),_possibleConstructorReturn(this,(WarehouseController.__proto__||Object.getPrototypeOf(WarehouseController)).apply(this,arguments))}return _inherits(WarehouseController,_Controller),_createClass(WarehouseController,[{key:"view",value:function view(){this._warehouseHelper(),this._containerHelper()}},{key:"updatePerishableProducts",value:function updatePerishableProducts(){GAME.model.warehouse.updatePerishableProducts()}},{key:"updateHoldingCost",value:function updateHoldingCost(){var a=GAME.model.base.products.reduce(function(b,c){var d=GAME.model.warehouse.getItemQuantity(c);return b+d*c.values.size*GAME.model.config.holdingCostPerSize},0);MoneyController.updateMoney(-a)}},{key:"updateContainerView",value:function updateContainerView(){$("#containers").empty(),this._containerHelper()}},{key:"updateCapacityView",value:function updateCapacityView(){$("#warehouse-used-capacity").html(GAME.model.warehouse.usedContainerCapacity()),$("#warehouse-max-capacity").html(GAME.model.warehouse.maxContainerCapacity()),$("#warehouse-progress-bar").css({width:GAME.model.warehouse.usedContainerCapacity(!0)+"%"}).attr("aria-valuenow",GAME.model.warehouse.usedContainerCapacity(!0))}},{key:"processFactoryOrder",value:function processFactoryOrder(a){var b=a.products.reduce(function(d,e){return d+e.shelfSize()},0),c=GAME.model.warehouse.maxContainerCapacity()-GAME.model.warehouse.usedContainerCapacity();return b>c?void toastr.error(Controller.l("There is no room left for this order in the warehouse!")):this._processOrder(a,"Order has been processed and added to the warehouse!")}},{key:"processCustomerOrder",value:function processCustomerOrder(a){return this._processOrder(a,"Order has been processed and shipped to the customer!")}},{key:"_processOrder",value:function _processOrder(a,b){if(a.products.forEach(function(c){for(;c.values.quantity;)GAME.model.warehouse.items.every(function(d){var e={FactoryOrder:d.addItem.bind(d),CustomerOrder:d.removeItem.bind(d)};return c.values.quantity=e[a.constructor.name](c),c.values.quantity})}),a.products.every(function(c){return 0===c.values.quantity}))return toastr.info(Controller.l(b)),!0}},{key:"_warehouseHelper",value:function _warehouseHelper(){this._loadTemplate("src/views/template/warehouse/warehouse.html","#warehouse",GAME.model.warehouse)}},{key:"_containerHelper",value:function _containerHelper(){var _this2=this;GAME.model.warehouse.items.forEach(function(a){a.itemsBySize=_this2._containerDivideProductsBySize(a),a.percentage=a.usedCapacity(!0),_get(WarehouseController.prototype.__proto__||Object.getPrototypeOf(WarehouseController.prototype),"_loadTemplate",_this2).call(_this2,"src/views/template/container/container.html","#containers",a,!0)}),GAME.model.warehouse.items.length<GAME.model.config.warehouseCapacity&&this._renderPurchaseContainer()}},{key:"_renderPurchaseContainer",value:function _renderPurchaseContainer(){var _this3=this;this._loadTemplate("src/views/template/container/purchasecontainer.html","#containers",GAME.model.config,!0).done(function(){$("#purchase-container").click(function(){GAME.model.config.money>GAME.model.config.addContainerCost?(GAME.model.warehouse.addItem(new Container("Rack",GAME.model.config.containerCapacity)),MoneyController.updateMoney(-GAME.model.config.addContainerCost),_this3.updateContainerView(),_this3.updateCapacityView(),toastr.success(Controller.l("Purchased an additional container!"))):toastr.warning(Controller.l("You cannot afford this!"))})})}},{key:"_containerDivideProductsBySize",value:function _containerDivideProductsBySize(a){return a.items.map(function(b){var c=Math.floor(b.shelfSize()/GAME.model.config.iconPerAmountProductSize),d=b.shelfSize()%GAME.model.config.iconPerAmountProductSize,e=Array(c).fill(GAME.model.config.iconPerAmountProductSize);return d&&e.push(d),e.map(function(f){return{product:b,color:this._percentageColorIndication(b.values.percentage||100),quantity:Math.floor(f/b.values.size)}},this)},this).reduce(function(b,c){return b.concat(c)},[])}},{key:"_percentageColorIndication",value:function _percentageColorIndication(a){var b=["red","yellow","green"],c=b.length;return b[Math.min(Math.floor(a*(c/100)),c-1)]}}]),WarehouseController}(Controller);